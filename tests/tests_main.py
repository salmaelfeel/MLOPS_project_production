import pytest
from fastapi.testclient import TestClient
from app.main import app  

client = TestClient(app)

def test_root():
    response = client.get("/")
    assert response.status_code == 200
    assert response.json() == {"message": "Welcome to the Hand Gesture Recognition API!"}

# If you don't have a /health endpoint, comment or remove this test
# def test_health_check():
#     response = client.get("/health")
#     assert response.status_code == 200
#     assert response.json() == {"status": "healthy"}

def test_predict():
    test_data = {
        "features": [
            0.706566333770752, 0.8228079080581665, -4.285662384972966e-07,
            0.6878318190574646, 0.8232738375663757, -0.015946492552757263,
            0.6728761792182922, 0.8222081661224365, -0.03511936590075493,
            0.6696698069572449, 0.8321068286895752, -0.054626062512397766,
            0.6719417572021484, 0.8443130254745483, -0.07422062754631042,
            0.6655991673469543, 0.7409479022026062, -0.03541377931833267,
            0.6614415645599365, 0.7812203168869019, -0.05744847655296326,
            0.6628732085227966, 0.8333377242088318, -0.07150745391845703,
            0.6672610640525818, 0.8722324371337891, -0.07906719297170639,
            0.6910379528999329, 0.7358694076538086, -0.03866157308220863,
            0.6884050965309143, 0.7939475774765015, -0.058304402977228165,
            0.6847571134567261, 0.8518884778022766, -0.06564339995384216,
            0.6836119890213013, 0.8945637941360474, -0.0686439648270607,
            0.7182254791259766, 0.7455655336380005, -0.04211688041687012,
            0.7170082926750183, 0.8069700598716736, -0.06345042586326599,
            0.7133290767669678, 0.8625569939613342, -0.061741311103105545,
            0.7132681012153625, 0.9045732617378235, -0.05632684752345085,
            0.7468644380569458, 0.7649109959602356, -0.04677276313304901,
            0.7507946491241455, 0.8144330382347107, -0.06208950653672218,
            0.7431795001029968, 0.8583465218544006, -0.0572366863489151,
            0.7399832010269165, 0.8901926875114441, -0.0496094711124897
        ]
    }

    response = client.post("/predict", json=test_data)
    assert response.status_code == 200
    assert "gesture" in response.json()  # Expect "gesture" instead of "prediction"
    assert isinstance(response.json()["gesture"], str)
